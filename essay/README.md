# 小论文

# 待选：v8运行引擎和跨语言调用原理

# 待选： 基于ElectronJs跨端技术的流程模型原理 

> https://segmentfault.com/a/1190000040102915
>
> https://juejin.cn/post/6966626823912308772



「一般来说，跨端技术有 4 类场景，分别是跨设备平台（跨`Web`端和手机端）、跨操作系统（如跨`Android`和`iOS`）、跨`App`以及跨渲染容器。」

需要解决性能、动态性、研发效率以及一致性的问题。

> **性能：** 如何通过前端和客户端的结合，实现更优的渲染性能以及交互性能;
>
> **动态性：** 客户端怎样能够实现更低成本的发版、甚至不发版直接动态更新代码；
> 研发效率：如何提升不同客户端的动态调试之类的研发效率；
>
> **一致性：** 如何实现一份代码的多端部署，并保证代码在多个客户端内展示形态的一致性以及兼容性问题。



ElectronJs是一个在2013年开源的基于Chromium和NodeJs的跨操作系统的桌面应用开发框架。



## 主要模块

Nodejs主要负责应用程序主线程逻辑控制、底层交互等功能，Chromium主要负责渲染线程窗口的业务逻辑。

本节分为两个模块探究其原理

Electron主要分为了逻辑进程和渲染进程，渲染进程主要是对每一打开的页面进行渲染，而逻辑进程主要是通过基于V8的NodeJs高性能API与系统层面API进行交互，提供应用原生操作的体验，比如访问系统文件夹、网络、等等。

### 1、Chromium

同样，浏览器中任何一个行为不当的网页也可能如此。一个页面或插件的错误就可能让整个浏览器崩溃。

Chromium也做了类似的设计，它把每个页面约束在单独的进程中，以保护整个浏览器不受单个页面中的故障影响。它甚至还限制了每个页面进程对其他进程和系统其他部分的访问，这极大地缓解了浏览器容易崩溃的问题。Chromium把管理页面、管理选项卡和插件的进程称为主进程。把特定于页面的进程称为渲染进程。



渲染进程使用Blink开源布局引擎来解释和渲染HTML。渲染进程与主进程通过IPC管道进行通信。

每个渲染进程都对应一个全局的RenderProcess对象，都有一个或多个RenderView对象。RenderProcess对象负责与主进程通信并管理这些RenderView对象，通常每个新窗口或选项卡都会在新进程中打开。

主进程负责创建这些新的进程，并指示它们创建各自的RenderView对象。



由于渲染进程运行在一个单独的进程中，所有页面脚本都在此进程中运行，当页面脚本尝试访问网络或本地资源时，当前渲染进程并不提供这样的服务，而是发消息给主进程，由主进程完成相应的工作，此时主进程会判断这些操作是否合法，比如跨越同源策略的请求、突破限制访问Cookie、https页面内内嵌http的页面等，这些行为都是不合法的行为，主进程可以拒绝提供服务，这就是浏览器的沙箱模式。



多进程模式并不是没有缺点，比如每个进程都会包含公共基础结构的副本（例如V8引擎的执行环境）、更复杂的通信模型等，这都意味着浏览器会消耗更多的内存、CPU甚至电能。

### 2、NodeJs

​	NodeJs是基于高性能V8的JavaScript执行引擎的一个服务端框架，融合了很多基础库，构建了一个单进程异步



Node的架构底层是一些c++的基础库、libuv、SSL、c-cares等等，赋予了Node高效的系统层api。在C++和JavaScript中间定义了相互调用的胶水代码，同时利用JavaScript构建了一套包加载机制，赋予了JS项目级别的管理能力。





回调的时候，c++的回调最后可能要回调到js层



## 主要概念

### 1、上下文隔离

### 2、沙盒

### 3、不同操作系统考虑

比如MacOS的关闭可能只是页面上的关闭，而Windows的关闭是直接退出

在 MacOS 和 Ubuntu, 托盘将位于屏幕右上角上，靠近你的电池和wifi 图标。 在 Windows 上，托盘通常位于右下角。







# 参考链接

张佳伟,张涛,周叶. 基于Electron的跨平台客户端技术[J]. 智能计算机与应用,2017,7(3):120-122.